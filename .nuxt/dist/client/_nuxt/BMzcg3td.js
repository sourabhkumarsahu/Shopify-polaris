import{_ as re}from"./CJ-M-fe-.js";import{_ as se,J as ae,r as n,i as f,o as de,e as ne,g as c,K as ie,t as i,L as b,A as r,z as d,B as u,x as _,M as V,v as p,N as E,O as R,y as k,P as ce,Q as $,R as A,S as h,T as ue}from"./BvuxK_1C.js";import{l as ge}from"./DaKztfBH.js";const ve={class:"header"},me=["value"],pe={key:0},D=50,fe={__name:"vm",setup(_e){const U=ae();let x=n({}),o=n([]);const C=Number(U.params.id),y=n(0),P=n(0),w=n(D),S=n(!1),v=n(null),W=window.innerWidth<640,l=n(W?2:6),a=n([]),z=async()=>{let e=await $fetch(`http://localhost:3000/api/collection/${C}/products-v2`);o.value=e.data.products,B()},B=()=>{if(P.value+w.value>=o.value.length){S.value=!0;return}w.value+=D},F=e=>{o.value[e].selected=!o.value[e].selected,o.value[e].selected?a.value.push(o.value[e]):a.value=a.value.filter(t=>t.productId!==o.value[e].productId)},O=e=>{console.log("drag end"),g()},g=()=>{o.value.forEach(e=>e.selected=!1),a.value=[]},T=e=>{!e.target.closest(".draggable")&&!e.target.closest("#navigationBar")&&g()},G=()=>{if(a.value.length===0){alert("No products selected");return}o.value=o.value.filter(t=>!t.selected);let e=Math.max(0,Math.min(y.value-1,o.value.length));o.value.splice(e,0,...a.value),g()},X=()=>{if(a.value.length===0){alert("No products selected");return}o.value=o.value.filter(e=>!e.selected),o.value.unshift(...a.value),g()},J=()=>{if(a.value.length===0){alert("No products selected");return}o.value=o.value.filter(e=>!e.selected),o.value.push(...a.value),g()},K=f(()=>a.value.length>0),Q=f(()=>o.value.slice(P.value,w.value)),M=new IntersectionObserver(e=>{e[0].isIntersecting&&B()},{root:null,rootMargin:"0px",threshold:1}),j=f(()=>({"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-1 lg:grid-cols-1":l.value===1,"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2":l.value===2,"grid grid-cols-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3":l.value===3,"grid grid-cols-4 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-4":l.value===4,"grid grid-cols-5 sm:grid-cols-2 md:grid-cols-5 lg:grid-cols-5":l.value===5,"grid grid-cols-6 sm:grid-cols-2 md:grid-cols-6 lg:grid-cols-6":l.value===6,"grid grid-cols-7 sm:grid-cols-2 md:grid-cols-7 lg:grid-cols-7":l.value===7,"grid grid-cols-8 sm:grid-cols-2 md:grid-cols-8 lg:grid-cols-8":l.value===8,"grid grid-cols-9 sm:grid-cols-2 md:grid-cols-9 lg:grid-cols-9":l.value===9,"grid grid-cols-10 sm:grid-cols-2 md:grid-cols-10 lg:grid-cols-10":l.value===10,"grid grid-cols-11 sm:grid-cols-2 md:grid-cols-11 lg:grid-cols-11":l.value===11,"grid grid-cols-12 sm:grid-cols-2 md:grid-cols-12 lg:grid-cols-12":l.value===12,"gap-4":!0})),q=f(()=>window.innerWidth<640?2:12);return de(async()=>{window.addEventListener("resize",()=>{window.innerWidth<640&&(l.value=2)});let e=await $fetch(`http://localhost:3000/api/collection/${C}`);x.value=e.data,x.value.merchandisingMode===1&&console.log("auto mode"),await z(),document.addEventListener("click",T),v.value&&M.observe(v.value)}),ne(()=>{document.removeEventListener("click",T),v.value&&M.unobserve(v.value)}),(e,t)=>{const m=c("Button"),H=re,N=c("LegacyStack"),I=c("Text"),Y=c("TextField"),Z=c("ButtonGroup"),ee=c("LegacyCard"),oe=c("Page"),te=ie("sortable");return i(),b(h(ue),{i18n:h(ge)},{default:r(()=>[d(oe,{fullWidth:"",backAction:{content:"Settings",url:"/"},title:"Visual Merchandising"},{primaryAction:r(()=>[d(m,{variant:"primary"},{default:r(()=>t[2]||(t[2]=[u("Sort Now")])),_:1})]),default:r(()=>[d(ee,{title:"Drag and drop",sectioned:""},{default:r(()=>[d(N,{spacing:"loose",vertical:""},{default:r(()=>[_("div",ve,[t[3]||(t[3]=_("label",{for:"cardsPerRow"},"Cards per row:",-1)),V(_("select",{id:"cardsPerRow","onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s)},[(i(!0),p(E,null,R(q.value,s=>(i(),p("option",{key:s,value:s},k(s),9,me))),128))],512),[[ce,l.value]])]),V((i(),p("div",{class:$(j.value)},[(i(!0),p(E,null,R(Q.value,(s,le)=>{var L;return i(),b(H,{class:$([{"sortable-selected":s.selected},"draggable rounded"]),key:s.productId,"product-image":(L=s.image)==null?void 0:L.src,"product-id":s.productId,"product-name":s.title,onClick:he=>F(le)},null,8,["class","product-image","product-id","product-name","onClick"])}),128))],2)),[[te,{animation:0,onEnd:O}]]),_("div",{ref_key:"loadMoreTrigger",ref:v,class:"load-more-trigger"},null,512),S.value?(i(),p("p",pe,"No more products to load")):A("",!0)]),_:1}),K.value?(i(),b(N,{key:0,id:"navigationBar",distribution:"trailing"},{default:r(()=>[d(I,{variant:"headingXs",as:"h6"},{default:r(()=>[u(k(h(o).length)+" Products ",1)]),_:1}),d(I,{variant:"headingXs",as:"h6"},{default:r(()=>[u(k(a.value.length)+" Selected ",1)]),_:1}),d(Y,{min:1,max:h(o).length,type:"number",label:"Send to position",modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),autoComplete:"off",class:"flex-1"},null,8,["max","modelValue"]),d(Z,{class:"flex flex-row gap-2 pt-2"},{default:r(()=>[d(m,{onClick:G,variant:"primary",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded"},{default:r(()=>t[4]||(t[4]=[u("Send")])),_:1}),d(m,{onClick:X,variant:"primary"},{default:r(()=>t[5]||(t[5]=[u("Send to Top")])),_:1}),d(m,{onClick:J,variant:"primary"},{default:r(()=>t[6]||(t[6]=[u("Send to Bottom")])),_:1}),d(m,{onClick:g,class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded"},{default:r(()=>t[7]||(t[7]=[u("Unselect")])),_:1})]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1})]),_:1},8,["i18n"])}}},ke=se(fe,[["__scopeId","data-v-60e0920a"]]);export{ke as default};
