{"version":3,"file":"AppProvider.vue_vue_type_script_setup_true_lang.js","sources":["../../../../../src/components/AppProvider/AppProvider.vue"],"sourcesContent":["<template lang=\"pug\">\n.polaris-app-provider\n  slot\n  #PolarisPortalsContainer(ref=\"portalsContainerRef\")\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onMounted, provide, ref } from 'vue';\nimport type { ThemeName } from '@shopify/polaris-tokens';\nimport {\n  createThemeClassName,\n  themeNameDefault,\n  themeNames,\n} from '@shopify/polaris-tokens';\nimport { I18n } from '@polaris/utilities/i18n/I18n';\nimport { ScrollLockManager } from '@polaris/utilities/scroll-lock-manager/scroll-lock-manager';\nimport { StickyManager } from '@/utilities/sticky-manager';\nimport type { LinkLikeComponent } from '@/utilities/link';\nimport type { VueNode } from '@/utilities/types';\nimport { type FeaturesConfig } from '@/utilities/features';\nimport { getTheme } from '@/utilities/use-theme';\nimport { useMediaQueryContext } from '@/use/useMediaQuery';\nimport { useFocusManagerContext } from '@/use/useFocusManager';\nimport { useEphemeralPresenceManagerContext } from '@/use/useEphemeralPresenceManager';\n\nexport type AppProviderProps = {\n  theme?: ThemeName;\n  /** A locale object or array of locale objects that overrides default translations. If specifying an array then your primary language dictionary should come first, followed by your fallback language dictionaries */\n  i18n: ConstructorParameters<typeof I18n>[0];\n  /** A custom component to use for all links used by Polaris components */\n  linkComponent?: LinkLikeComponent;\n  /** For toggling features */\n  features?: FeaturesConfig;\n}\n\nexport type AppProviderSlots = {\n  /** Inner content of the application */\n  default?: (_: VueNode) => any;\n}\n\nconst MAX_SCROLLBAR_WIDTH = 20;\nconst SCROLLBAR_TEST_ELEMENT_PARENT_SIZE = 30;\nconst SCROLLBAR_TEST_ELEMENT_CHILD_SIZE = SCROLLBAR_TEST_ELEMENT_PARENT_SIZE + 10;\nconst APP_FRAME_SCROLLABLE = 'AppFrameScollable';\n\nconst props = defineProps<AppProviderProps>();\ndefineSlots<AppProviderSlots>();\n\nconst stickyManager = ref(new StickyManager());\nconst scrollLockManager = new ScrollLockManager();\n\nconst { isNavigationCollapsed } = useMediaQueryContext();\nconst focusManager = useFocusManagerContext();\nconst ephemeralPresenceManager = useEphemeralPresenceManagerContext();\n\nconst portalsContainerRef = ref<HTMLElement | null>(null);\n\nconst themeName = computed<ThemeName>(() => props.theme ?? themeNameDefault);\n\nonMounted(() => {\n  if (document != null) {\n\n    if (!props.features?.dynamicTopBarAndReframe) {\n      stickyManager.value.setContainer(document);\n    } else {\n      const scrollContainerElement = document.getElementById(APP_FRAME_SCROLLABLE);\n\n      stickyManager.value.setContainer(scrollContainerElement || document);\n    }\n\n    setBodyStyles();\n    setRootAttributes();\n\n    const isSafari16 =\n      navigator.userAgent.includes('Safari') &&\n      !navigator.userAgent.includes('Chrome') &&\n      (navigator.userAgent.includes('Version/16.1') ||\n        navigator.userAgent.includes('Version/16.2') ||\n        navigator.userAgent.includes('Version/16.3'));\n\n    const isMobileApp16 =\n      navigator.userAgent.includes('Shopify Mobile/iOS') &&\n      (navigator.userAgent.includes('OS 16_1') ||\n        navigator.userAgent.includes('OS 16_2') ||\n        navigator.userAgent.includes('OS 16_3'));\n\n    if (isSafari16 || isMobileApp16) {\n      document.documentElement.classList.add(\n        'Polaris-Safari-16-Font-Optical-Sizing-Patch',\n      );\n    }\n  }\n  measureScrollbars();\n});\n\nconst setBodyStyles = () => {\n  document.body.style.backgroundColor = 'var(--p-color-bg)';\n  document.body.style.color = 'var(--p-color-text)';\n};\n\nconst setRootAttributes = () => {\n  const activeThemeName = themeName.value;\n\n  themeNames.forEach((themeName) => {\n    document.documentElement.classList.toggle(\n      createThemeClassName(themeName),\n      themeName === activeThemeName,\n    );\n  });\n};\n\nfunction measureScrollbars() {\n  const parentEl = document.createElement('div');\n  parentEl.setAttribute(\n    'style',\n    `position: absolute; opacity: 0; transform: translate3d(-9999px, -9999px, 0); pointer-events: none; width:${SCROLLBAR_TEST_ELEMENT_PARENT_SIZE}px; height:${SCROLLBAR_TEST_ELEMENT_PARENT_SIZE}px;`,\n  );\n\n  const child = document.createElement('div');\n  child.setAttribute(\n    'style',\n    `width:100%; height: ${SCROLLBAR_TEST_ELEMENT_CHILD_SIZE}; overflow:scroll; ; scrollbar-width: thin;`,\n  );\n  parentEl.appendChild(child);\n  document.body.appendChild(parentEl);\n\n  const scrollbarWidth =\n    SCROLLBAR_TEST_ELEMENT_PARENT_SIZE -\n    (parentEl.firstElementChild?.clientWidth ?? 0);\n\n  const scrollbarWidthWithSafetyHatch = Math.min(\n    scrollbarWidth,\n    MAX_SCROLLBAR_WIDTH,\n  );\n\n  document.documentElement.style.setProperty(\n    '--pc-app-provider-scrollbar-width',\n    `${scrollbarWidthWithSafetyHatch}px`,\n  );\n\n  document.body.removeChild(parentEl);\n}\n\nprovide('themeName', themeName);\nprovide('theme', getTheme(themeName.value)); // TODO: This should be reactive\nprovide('features', props.features ?? {});\nprovide('i18n', new I18n(props.i18n));\nprovide('scroll-lock-manager', scrollLockManager);\nprovide('sticky-manager', stickyManager);\nprovide('link', props.linkComponent);\nprovide('media-query', { isNavigationCollapsed });\nprovide('portals-manager', portalsContainerRef);\nprovide('focus-manager', focusManager);\nprovide('ephemeral-presence-manager', ephemeralPresenceManager);\n</script>\n\n<style lang=\"scss\">\n@import '@polaris/components/AppProvider/global.css';\n</style>\n"],"names":["themeName"],"mappings":";;;;;;;;;;AAwCA,MAAM,sBAAsB;AAC5B,MAAM,qCAAqC;AAE3C,MAAM,uBAAuB;;;;;;;;;;AAD7B,UAAM,oCAAoC,qCAAqC;AAG/E,UAAM,QAAQ;AAGd,UAAM,gBAAgB,IAAI,IAAI,cAAe,CAAA;AACvC,UAAA,oBAAoB,IAAI;AAExB,UAAA,EAAE,0BAA0B;AAClC,UAAM,eAAe;AACrB,UAAM,2BAA2B;AAE3B,UAAA,sBAAsB,IAAwB,IAAI;AAExD,UAAM,YAAY,SAAoB,MAAM,MAAM,SAAS,gBAAgB;AAE3E,cAAU,MAAM;;AACd,UAAI,YAAY,MAAM;AAEhB,YAAA,GAAC,WAAM,aAAN,mBAAgB,0BAAyB;AAC9B,wBAAA,MAAM,aAAa,QAAQ;AAAA,QAAA,OACpC;AACC,gBAAA,yBAAyB,SAAS,eAAe,oBAAoB;AAE7D,wBAAA,MAAM,aAAa,0BAA0B,QAAQ;AAAA,QACrE;AAEc;AACI;AAEZ,cAAA,aACJ,UAAU,UAAU,SAAS,QAAQ,KACrC,CAAC,UAAU,UAAU,SAAS,QAAQ,MACrC,UAAU,UAAU,SAAS,cAAc,KAC1C,UAAU,UAAU,SAAS,cAAc,KAC3C,UAAU,UAAU,SAAS,cAAc;AAE/C,cAAM,gBACJ,UAAU,UAAU,SAAS,oBAAoB,MAChD,UAAU,UAAU,SAAS,SAAS,KACrC,UAAU,UAAU,SAAS,SAAS,KACtC,UAAU,UAAU,SAAS,SAAS;AAE1C,YAAI,cAAc,eAAe;AAC/B,mBAAS,gBAAgB,UAAU;AAAA,YACjC;AAAA,UAAA;AAAA,QAEJ;AAAA,MACF;AACkB;IAAA,CACnB;AAED,UAAM,gBAAgB,MAAM;AACjB,eAAA,KAAK,MAAM,kBAAkB;AAC7B,eAAA,KAAK,MAAM,QAAQ;AAAA,IAAA;AAG9B,UAAM,oBAAoB,MAAM;AAC9B,YAAM,kBAAkB,UAAU;AAEvB,iBAAA,QAAQ,CAACA,eAAc;AAChC,iBAAS,gBAAgB,UAAU;AAAA,UACjC,qBAAqBA,UAAS;AAAA,UAC9BA,eAAc;AAAA,QAAA;AAAA,MAChB,CACD;AAAA,IAAA;AAGH,aAAS,oBAAoB;;AACrB,YAAA,WAAW,SAAS,cAAc,KAAK;AACpC,eAAA;AAAA,QACP;AAAA,QACA,4GAA4G,kCAAkC,cAAc,kCAAkC;AAAA,MAAA;AAG1L,YAAA,QAAQ,SAAS,cAAc,KAAK;AACpC,YAAA;AAAA,QACJ;AAAA,QACA,uBAAuB,iCAAiC;AAAA,MAAA;AAE1D,eAAS,YAAY,KAAK;AACjB,eAAA,KAAK,YAAY,QAAQ;AAElC,YAAM,iBACJ,wCACC,cAAS,sBAAT,mBAA4B,gBAAe;AAE9C,YAAM,gCAAgC,KAAK;AAAA,QACzC;AAAA,QACA;AAAA,MAAA;AAGF,eAAS,gBAAgB,MAAM;AAAA,QAC7B;AAAA,QACA,GAAG,6BAA6B;AAAA,MAAA;AAGzB,eAAA,KAAK,YAAY,QAAQ;AAAA,IACpC;AAEA,YAAQ,aAAa,SAAS;AAC9B,YAAQ,SAAS,SAAS,UAAU,KAAK,CAAC;AAC1C,YAAQ,YAAY,MAAM,YAAY,CAAE,CAAA;AACxC,YAAQ,QAAQ,IAAI,KAAK,MAAM,IAAI,CAAC;AACpC,YAAQ,uBAAuB,iBAAiB;AAChD,YAAQ,kBAAkB,aAAa;AAC/B,YAAA,QAAQ,MAAM,aAAa;AAC3B,YAAA,eAAe,EAAE,sBAAA,CAAuB;AAChD,YAAQ,mBAAmB,mBAAmB;AAC9C,YAAQ,iBAAiB,YAAY;AACrC,YAAQ,8BAA8B,wBAAwB;;;;;;;;;;;;;"}