{"version":3,"file":"scroll-lock-manager.js","sources":["../../../../../../../polaris/polaris-react/src/utilities/scroll-lock-manager/scroll-lock-manager.ts"],"sourcesContent":["import {isServer} from '../target';\n\nexport const SCROLL_LOCKING_ATTRIBUTE = 'data-lock-scrolling';\n\nconst SCROLL_LOCKING_HIDDEN_ATTRIBUTE = 'data-lock-scrolling-hidden';\n\nconst SCROLL_LOCKING_WRAPPER_ATTRIBUTE = 'data-lock-scrolling-wrapper';\n\nlet scrollPosition = 0;\n\nfunction isScrollBarVisible() {\n  const {body} = document;\n  return body.scrollHeight > body.clientHeight;\n}\n\nexport class ScrollLockManager {\n  private scrollLocks = 0;\n  private locked = false;\n\n  registerScrollLock() {\n    this.scrollLocks += 1;\n    this.handleScrollLocking();\n  }\n\n  unregisterScrollLock() {\n    this.scrollLocks -= 1;\n    this.handleScrollLocking();\n  }\n\n  handleScrollLocking() {\n    if (isServer) return;\n\n    const {scrollLocks} = this;\n    const {body} = document;\n    const wrapper = body.firstElementChild;\n\n    if (scrollLocks === 0) {\n      body.removeAttribute(SCROLL_LOCKING_ATTRIBUTE);\n      body.removeAttribute(SCROLL_LOCKING_HIDDEN_ATTRIBUTE);\n      if (wrapper) {\n        wrapper.removeAttribute(SCROLL_LOCKING_WRAPPER_ATTRIBUTE);\n      }\n      window.scroll(0, scrollPosition);\n      this.locked = false;\n    } else if (scrollLocks > 0 && !this.locked) {\n      scrollPosition = window.pageYOffset;\n      body.setAttribute(SCROLL_LOCKING_ATTRIBUTE, '');\n\n      if (!isScrollBarVisible()) {\n        body.setAttribute(SCROLL_LOCKING_HIDDEN_ATTRIBUTE, '');\n      }\n\n      if (wrapper) {\n        wrapper.setAttribute(SCROLL_LOCKING_WRAPPER_ATTRIBUTE, '');\n        wrapper.scrollTop = scrollPosition;\n      }\n      this.locked = true;\n    }\n  }\n\n  resetScrollPosition() {\n    scrollPosition = 0;\n  }\n}\n"],"names":[],"mappings":";AAEO,MAAM,2BAA2B;AAExC,MAAM,kCAAkC;AAExC,MAAM,mCAAmC;AAEzC,IAAI,iBAAiB;AAErB,SAAS,qBAAqB;AACtB,QAAA,EAAC,KAAQ,IAAA;AACR,SAAA,KAAK,eAAe,KAAK;AAClC;AAEO,MAAM,kBAAkB;AAAA,EAAxB,cAAA;AACL,SAAQ,cAAc;AACtB,SAAQ,SAAS;AAAA,EAAA;AAAA,EAEjB,qBAAqB;AACnB,SAAK,eAAe;AACpB,SAAK,oBAAoB;AAAA,EAC3B;AAAA,EAEA,uBAAuB;AACrB,SAAK,eAAe;AACpB,SAAK,oBAAoB;AAAA,EAC3B;AAAA,EAEA,sBAAsB;AACpB,QAAI,SAAU;AAER,UAAA,EAAC,YAAe,IAAA;AAChB,UAAA,EAAC,KAAQ,IAAA;AACf,UAAM,UAAU,KAAK;AAErB,QAAI,gBAAgB,GAAG;AACrB,WAAK,gBAAgB,wBAAwB;AAC7C,WAAK,gBAAgB,+BAA+B;AACpD,UAAI,SAAS;AACX,gBAAQ,gBAAgB,gCAAgC;AAAA,MAC1D;AACO,aAAA,OAAO,GAAG,cAAc;AAC/B,WAAK,SAAS;AAAA,IACL,WAAA,cAAc,KAAK,CAAC,KAAK,QAAQ;AAC1C,uBAAiB,OAAO;AACnB,WAAA,aAAa,0BAA0B,EAAE;AAE1C,UAAA,CAAC,sBAAsB;AACpB,aAAA,aAAa,iCAAiC,EAAE;AAAA,MACvD;AAEA,UAAI,SAAS;AACH,gBAAA,aAAa,kCAAkC,EAAE;AACzD,gBAAQ,YAAY;AAAA,MACtB;AACA,WAAK,SAAS;AAAA,IAChB;AAAA,EACF;AAAA,EAEA,sBAAsB;AACH,qBAAA;AAAA,EACnB;AACF;"}